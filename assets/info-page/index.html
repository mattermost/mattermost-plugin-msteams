<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.cdnfonts.com/css/metropolis-2" rel="stylesheet">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script>
      const mattermostPrimaryPlatform = 'mattermost';
      const msteamsPrimaryPlatform = 'msteams';
      const mmSelectIconClass = 'select-icon__mm';
      const msteamsSelectIconClass = 'select-icon__msteams';
      const mmCardBody = 'mm-card__body';
      const msteamsCardBody = 'msteams-card__body';
      const mmCardHeading = 'mm-card__heading';
      const msteamsCardHeading = 'msteams-card__heading';
      const selectButtonClass = 'selection-button';
      let choosenPlatform = '';

      closeInfoPage = () => {
        window.close();
      }

      selectPrimaryPlatform = (platform) => {
        document.getElementById(selectButtonClass).style.backgroundColor = '#1C58D9';
        choosenPlatform = platform;
        const mediaQuery = window.matchMedia('(min-width: 550px)');
          if (platform === mattermostPrimaryPlatform) {
            document.getElementById(mmSelectIconClass).classList.remove('d-none');
            document.getElementById(msteamsSelectIconClass).classList.add('d-none');
            document.getElementById(msteamsPrimaryPlatform).classList.add('color-none');
            document.getElementById(mattermostPrimaryPlatform).classList.remove('color-none');
            if (!mediaQuery.matches) {
              document.getElementById(mmCardBody).classList.remove('d-none');
              document.getElementById(msteamsCardBody).classList.add('d-none');
              document.getElementById(mmCardHeading).classList.add('border-bottom');
              document.getElementById(msteamsCardHeading).classList.remove('border-bottom');
            }
          } else {
            document.getElementById(mmSelectIconClass).classList.add('d-none');
            document.getElementById(msteamsSelectIconClass).classList.remove('d-none');
            document.getElementById(mattermostPrimaryPlatform).classList.add('color-none');
            document.getElementById(msteamsPrimaryPlatform).classList.remove('color-none');
            if (!mediaQuery.matches) {
              document.getElementById(msteamsCardBody).classList.remove('d-none');
              document.getElementById(mmCardBody).classList.add('d-none');
              document.getElementById(msteamsCardHeading).classList.add('border-bottom');
              document.getElementById(mmCardHeading).classList.remove('border-bottom');
            }
          }
      }

      choosePrimaryPlatform = () => {
        if (!choosenPlatform) {
          return;
        }
        const serverURL = "{{.ServerURL}}";
        const apiEndpoint = "{{.APIEndPoint}}";
        const queryParam = "{{.QueryParamPrimaryPlatform}}";        
        fetch(`${serverURL}${apiEndpoint}?${queryParam}=${choosenPlatform}`)
        .then(() => closeInfoPage());
      }
      
      window.addEventListener('resize', function(){
        if (choosenPlatform != '') {
          selectPrimaryPlatform(choosenPlatform);
        }
      });
    </script>
    <style>
      .msteams-sync-info-page {
        max-width: 100%;
        display: flex;
        flex-direction: row-reverse;
        padding: 0 20px;
      }

      .msteams-sync-close-icon {
        display: none;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-close-icon {
          display: block;
          padding-top: 30px;
          height: 20px;
          cursor: pointer;
        }
      }

      .msteams-sync-body {
        color: #3F4350;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: 'Metropolis', sans-serif;
        width: 99%;
      }

      .msteams-sync-body .heading-body {
        margin-bottom: 32px;
        text-align: center;
      }

      .msteams-sync-body .heading {
        font-weight: 600;
        font-size: 25px;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .heading {
          display: flex;
          flex-direction: column;
          font-size: 30px;
        }
      }

      @media screen and (min-width: 550px) {
        .msteams-sync-body .heading__sub-heading {
          display: block;
        }
      }

      .msteams-sync-body .connection-icon {
        display: flex;
        justify-content: center;
      }

      .msteams-sync-body .card-holder {
        display: flex;
        flex-direction: column;
        width: 100%;
        align-items: center;
        justify-content: space-between;
        box-sizing: border-box;
        gap: 20px;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .card-holder {
          flex-direction: row;
          width: 1000px;
          max-width: 95%;
        }
      }

      .msteams-sync-body .d-none {
        display: none;
      }

      .msteams-sync-body .card {
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 1px solid rgba(63, 67, 80, 0.1607843137);
        outline: 3px solid #1C58D9;
        border-radius: 8px;
        box-sizing: border-box;
        cursor: pointer;
        width: 100%;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .card {
          width: 49%;
          height: 100%;
        }
      }

      .msteams-sync-body .color-none {
        outline: 3px solid transparent !important;
      }

      .msteams-sync-body .card__heading {
        display: flex;
        padding: 5%;
        align-items: center;
        width: 100%;
        box-sizing: border-box;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .card__heading {
          border-bottom: 1px solid rgba(63, 67, 80, 0.1607843137) !important;
          height: 30%;
        }
      }

      .msteams-sync-body .card__logo {
        height: 42px;
        width: 45px;
      }

      .msteams-sync-body .card__logo-details {
        font-weight: 600;
        font-size: 18px;
        margin-left: 15px;
        width: 70%;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .card__logo-details {
          font-size: 20px;
        }
      }

      .msteams-sync-body .border-bottom {
        border-bottom: 1px solid #3F435029;
      }

      .msteams-sync-body .card__body {
        width: 100%;
        height: 60%;
        box-sizing: border-box;
        padding: 5%;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .card__body {
          display: block !important;
        }
      }

      .msteams-sync-body .card__sub-heading {
        font-weight: 600;
        font-size: 14px;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .card__sub-heading {
          font-size: 16px;
        }
      }

      .d-none {
        display: none;
      }

      .color-none {
        outline: 3px solid transparent !important;
      }
      
      .msteams-sync-body .select-icon {
        margin-left: auto;
      }

      .msteams-sync-body .list {
        list-style: none;
        padding: 0;
      }

      .msteams-sync-body .list-item {
        display: flex;
        gap: 5px;
        margin-bottom: 10px;
        font-size: 14px;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .list-item {
          font-size: 16px;
        }
      }

      .msteams-sync-body .list-icon {
        height: 20px;
      }

      .msteams-sync-body .list-link {
        text-decoration: none;
        display: contents;
      }

      .msteams-sync-body .selection-button {
        text-align: center;
        margin: 40px 0;
        background-color: #3f435052;
      }

      .msteams-sync-body .selection-button__text {
        display: flex;
        gap: 10px;
        border-radius: 4px;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        font-size: 16px;
      }

      .msteams-sync-body .footer {
        text-align: center;
        font-size: 14px;
      }
      @media screen and (min-width: 550px) {
        .msteams-sync-body .footer {
          font-size: 16px;
        }
      }

      .msteams-sync-body .footer-link {
        text-decoration: none;
      }
    </style>
    <title>MS Teams Connection Information</title>
  </head>
  <body class="msteams-sync">
    <div class="msteams-sync-info-page">
      <img src="static/close-icon.png" alt="close-icon" class="msteams-sync-close-icon" onclick="closeInfoPage()"/>
      <div class="msteams-sync-body">
        <div class="connection-icon">
        <img src="static/connection-icon.png" alt="connection-icon"/>
        </div>
        <div class="heading-body">
          <div class="heading">Your account is now connected.
          <span class="heading__sub-heading">How will you be using the two platforms?</span></div>
        </div>
        <div class="card-holder">
          <div class="card color-none" onclick="selectPrimaryPlatform('mattermost')" id="mattermost">
            <div class="card__heading" id="mm-card__heading">
              <div class="card__logo-holder">
                <img src="static/mm-icon.png" alt="mm-icon" class="card__logo"/>
              </div>
              <div class="card__logo-details">Mattermost will be my primary platform</div>
              <div class="select-icon">
                <img src="static/select-icon.png" alt="select-icon" class="d-none" id="select-icon__mm"/>
              </div>
            </div>
            <div class="card__body d-none" id="mm-card__body">
              <div class="card__sub-heading">What this choice means:</div>
              <ul class="list">
                <li class="list-item">
                  <img src="static/list-icon-info.png" alt="list-icon" class="list-icon">Linked channel and direct messages from Microsoft Teams will be synced in Mattermost
                </li>
                <li class="list-item">
                  <img src="static/list-icon-info.png" alt="list-icon" class="list-icon">You will get notifications in Mattermost for synced messages and channels.
                </li>
                <li class="list-item">
                  <!-- TODO: Add correct links here -->
                  <img src="static/list-icon-warn.png" alt="list-icon" class="list-icon">You will need to disable notifications in Microsoft Teams to avoid duplicates. <a href="learn-more-url" class="list-link">Learn more</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="card color-none" onclick="selectPrimaryPlatform('msteams')" id="msteams">
            <div class="card__heading" id="msteams-card__heading">
              <div class="card__logo-holder">
                <img src="static/msteams-icon.png" alt="msteams-icon" class="card__logo"/>
              </div>
              <div class="card__logo-details">Microsoft Teams will be my primary platform</div>
              <div class="select-icon">
                <img src="static/select-icon.png" alt="select-icon" class="d-none" id="select-icon__msteams"/>
              </div>
            </div>
            <div class="card__body d-none" id="msteams-card__body">
              <div class="card__sub-heading">What this choice means:</div>
              <ul class="list">
                <li class="list-item">
                  <img src="static/list-icon-info.png" alt="list-icon" class="list-icon">Linked channels and direct messages from Microsoft Teams will still be synced in Mattermost
                </li>
                <li class="list-item">
                  <!-- TODO: Add correct links here -->
                  <img src="static/list-icon-warn.png" alt="list-icon" class="list-icon">Notifications in Mattermost will be muted for linked channels and DMs to prevent duplicates. <a href="learn-more-url" class="list-link">Learn more</a>
                </li>
                <li class="list-item">
                  <img src="static/list-icon-warn.png" alt="list-icon" class="list-icon">Unread statuses in linked channels and DMs will not be synced between Mattermost and Microsoft Teams.
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="selection-button" id="selection-button" onclick="choosePrimaryPlatform()">
          <a class="selection-button__text">Continue <img src="static/trailing-icon.png" alt="trailing-icon"/></a>   
        </div>
        <div class="footer">
          <!-- TODO: Add correct links here -->
          You can <a href="skip-url" class="footer-link">skip this for now</a> and change it in your account settings later. For more information <a href="help-url" class="footer-link">visit this help article.</a>
        </div>
      </div>
    </div>
  </body>
</html>
